# Shift Handover & Rollover Logic - ุงูุชูุซูู ุงููุงูู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงูู Rollover ูุฏูุฑ ููู ุงูุนูู ุบูุฑ ุงูููุชูู ูู shift ุฅูู ุงูุขุฎุฑุ ูุน ุถูุงู:
- ุชูุงุฒู ุงูุญูู ุจูู ุงูู shifts
- ุนุฏู ุชุฌุงูุฒ ุณุงุนุงุช ุงูู shift ุงููุงุญุฏ
- ุชุณูุณู ููุทูู ููุนูู ุงูุฒุงุฆุฏ

---

## ๐ ุฃููุงุน ุงูุนูููุงุช ุงูุซูุงุซุฉ

### 1๏ธโฃ ุชุญุช ุงููุฏู (Under-Achievement) ๐
**ุงูุญุงูุฉ**: ุงูููู ุฃูุฌุฒ ุฃูู ูู ุงููุทููุจ

```
ุงููุทููุจ: 1000 ูููู
ุงูุฅูุฌุงุฒ: 700 ูููู
ุงููุงูุต: 300 ูููู โ ููุชูู ููู shift ุงููุงุฏู
```

**ุงูุฎุทูุงุช**:
1. ุญุณุงุจ ุงููููุฉ ุงููุงูุตุฉ (300 ูููู)
2. ุญุณุงุจ ุงูุณุงุนุงุช ุงููุทููุจุฉ: `ุณุงุนุงุช = ูููุฉ ูุงูุตุฉ / ูุนุฏู ุงูุฅูุชุงุฌ`
3. ุงูุชุญูู ูู ุชููุฑ ููุงู ูู ุงูู shift ุงููุงุฏู
4. ุฅุฐุง ูุงู ุงูู shift ุงููุงุฏู ููุชูุฆ โ **ุชูุฑูุบ ููุงู** ูู ููุงู ุฃุฎุฑู

### 2๏ธโฃ ููู ุงููุฏู (Over-Achievement) ๐
**ุงูุญุงูุฉ**: ุงูููู ุฃูุฌุฒ ุฃูุซุฑ ูู ุงููุทููุจ

```
ุงููุทููุจ: 1000 ูููู
ุงูุฅูุฌุงุฒ: 1200 ูููู
ุงูุฒุงุฆุฏ: 200 ูููู โ ููุฎูู ูู ุงูู shift ุงููุงุฏู
```

**ุงูุฎุทูุงุช**:
1. ุญุณุงุจ ุงููููุฉ ุงูุฒุงุฆุฏุฉ (200 ูููู)
2. ุญุณุงุจ ุงูุณุงุนุงุช ุงููุญุฑุฑุฉ
3. ุฎูุถ ูุฏู ุงูููุชุฌ ููุณู ูู ุงูู shift ุงููุงุฏู
4. ุณุญุจ ููุงู ูู shiftsูุงุญูุฉ ุฅุฐุง ุชุญุฑุฑ ููุงู ูุจูุฑ

### 3๏ธโฃ ุงูุชุณูุณู (Cascade) ๐
**ุงูุญุงูุฉ**: ุนูุฏูุง ูุง ูุชุณุน ุงูู shift ุงููุงุฏู

```
Shift 1: ููุชูุฆ (8 ุณุงุนุงุช)
โ ูุญุชุงุฌ 5 ุณุงุนุงุช rollover
โ ููุฑุบ 5 ุณุงุนุงุช ูู ููุงู ููุฌูุฏุฉ
โ ุชูู ุงูููุงู ุชูุชูู ููู Shift 2

Shift 2: ููุชูุฆ ุฃูุถุงูุ
โ ููุฑุบ 5 ุณุงุนุงุช ุฃุฎุฑู
โ ุชูุชูู ููู Shift 3
...
```

**ุงูุญุฏ ุงูุฃูุตู**: 10 shifts ูู ุงูุชุณูุณู

---

## ๐ก ุงูุนูููุฉ ุงูุฑุฆูุณูุฉ ุงููุญุฏุซุฉ

### โจ ุงููุฑู ุงูุฑุฆูุณู (ุงูุฌุฏูุฏ)

**ุงูุณุงุจู:**
- ุฅุฐุง ูุงู shift ุงููุงุฏู ููุชูุฆ โ ููู ุงููููุฉ ูุจุงุดุฑุฉ ููู shift ุงูุชุงูู

**ุงูุญุฏูุซ (ุงูุตุญูุญ):**
- ุฅุฐุง ูุงู shift ุงููุงุฏู ููุชูุฆ โ ุชูุฑูุบ ููุงู ุจููุณ ุนุฏุฏ ุงูุณุงุนุงุช ูุงูุฏูุงุฆู
  - ูุชู ุงูุชูุงุก ูููุฉ ุฐุงุช ุฃููููุฉ ุฃูู
  - ุชูููู ุฃู ุญุฐู ุฌุฒุก ูููุง
  - ุงูุนูู ุงููุทููุน ููููู ููู shift ุงูุชุงูู
  - ุซู ุงูู rollover ูุฏุฎู ุงูููุงู ุงูููุฑุบ

### ุงูููุฏ ุงูุฌุฏูุฏ:
```javascript
// ุฅุฐุง ุงุญุชุฌูุง ููุงู ุฃูุซุฑ ูู ุงููุชุงุญ
if (timeNeeded > availableHours) {
    const timeToDeduct = timeNeeded - availableHours;
    
    // ูุฌุฏ ููุงู ุฃุฎุฑู ุฐุงุช ุฃููููุฉ ุฃูู
    for (const task of tasksOrderedByPriority) {
        // ูุฎูุถ ุงููููุฉ ุงููุทููุจุฉ ูู ูุฐู ุงููููุฉ
        const deductedAmount = reduce(task, timeToDeduct);
        
        // ูููู ุงููุฎููุถ ููู shift ุงูุชุงูู
        cascade(deductedAmount, nextShift);
    }
}
```

---

## ๐ ูุซุงู ุนููู ูุงูู

### ุงูุณููุงุฑูู:
```
ุงูุชุงุฑูุฎ: 2025-01-21
ุงูู Shift: Second Shift (2 ุธูุฑุงู - 10 ูุณุงุกู)

ุงูููุงู ุงูุญุงููุฉ:
โโ Task 1: ุจูุงุณุชูู ุฃุฒุฑู - 1000 ูููู (ูุนุฏู: 150 ูููู/ุณุงุนุฉ)
โ  ุงูุฅูุฌุงุฒ: 700 ูููู โ ูุงูุต 300 ูููู
โ  ุงูุณุงุนุงุช ุงููุทููุจุฉ: 300 / 150 = 2 ุณุงุนุฉ
โโ ุงูููู ููู Third Shift
```

### ุงูู Third Shift ุงูุญุงูู:
```
ุงูููุงู ุงูููุฌูุฏุฉ:
โโ Task 2: ุจูุงุณุชูู ุฃุญูุฑ - 500 ูููู (3 ุณุงุนุงุช)
โโ Task 3: ุจูุงุณุชูู ุฃุฎุถุฑ - 600 ูููู (4 ุณุงุนุงุช)
โโ Task 4: ุญุฏูุฏ - 200 ูููู (1 ุณุงุนุฉ)
โโ ุงููุฌููุน: 8 ุณุงุนุงุช (ููุชูุฆ ุจุงููุงูู) โ
```

### ุงูุญู (ุงูุฌุฏูุฏ):
```
1. ูุญุชุงุฌ 2 ุณุงุนุฉ ููุงู
   
2. ูุฎุชุงุฑ Task 4 (ุฃููููุฉ ุฃูู - ุญุฏูุฏ)
   โโ ูููู ุจู ูู 200 ูููู (1 ุณุงุนุฉ) ุฅูู 0 ูููู
   โโ ูุญุชุงุฌ 1 ุณุงุนุฉ ุฃุฎุฑู

3. ูุฎุชุงุฑ Task 3 (ุจูุงุณุชูู ุฃุฎุถุฑ)
   โโ ูููู: 1 ุณุงุนุฉ ูู 4 ุณุงุนุงุช
   โโ = 150 ูููู ูู 600 ูููู
   โโ ูุตุจุญ 450 ูููู (3 ุณุงุนุงุช) ุจุฏู 600

4. ุงููุชูุฌุฉ ูู Third Shift:
   โโ ุจูุงุณุชูู ุฃุฒุฑู: 300 ูููู (2 ุณุงุนุฉ) โ [ROLLOVER]
   โโ ุจูุงุณุชูู ุฃุญูุฑ: 500 ูููู (3 ุณุงุนุงุช) โ
   โโ ุจูุงุณุชูู ุฃุฎุถุฑ: 450 ูููู (3 ุณุงุนุงุช) โ
   โ ุงููุฌููุน: 8 ุณุงุนุงุช โ

5. ุงูุนูู ุงููุทููุน ูุฐูุจ ููู Fourth Shift:
   โโ ุญุฏูุฏ: 200 ูููู (1 ุณุงุนุฉ) [CASCADE]
   โโ ุจูุงุณุชูู ุฃุฎุถุฑ: 150 ูููู (1 ุณุงุนุฉ) [CASCADE]
```

---

## ๐๏ธ ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### 1. Logic ุงูู Cascade ุงููุญุฏุซ
โ ุชูุฑูุบ ููุงู ุจุฏู ููู ูุงูู ุงููููุฉ
โ ูุนุงูุฌุฉ ุฃูุถู ููููุงู ุฐุงุช ุงูุฃููููุงุช
โ Logs ุชูุตูููุฉ ููู ุฎุทูุฉ

### 2. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
โ ุญูุธ ุงูุนูููุงุช ุงูููุฌุฒุฉ
โ Logs ูุงุถุญุฉ ูููุดู
โ ููุน ุงูู duplicates

### 3. ุงูู Logs ูุงูุชุชุจุน
โ ุจุฏุงูุฉ ูููุงูุฉ ูุงุถุญุฉ ููุนูููุฉ
โ ูุนูููุงุช ุงูุชูุงุตูู ููู ุฎุทูุฉ
โ ููุฎุต ูู ุงูููุงูุฉ

```
============================================================
๐ SHIFT HANDOVER PROCESS STARTED
============================================================
๐ Achievement: 700, Target: 1000, Diff: -300
๐ Rollover: 300 units (2.00 hrs) to Third Shift
๐ Shift capacity: 8.00/8 hrs used, 0.00 hrs available
โ๏ธ Need to free 2.00 hrs. Deducting from next shift tasks...
   ๐ป Deducting 200 units (1.00 hrs) from: ุญุฏูุฏ 200 ูููู
      โ Deleted task (no time remaining)
   ๐ป Deducting 150 units (1.00 hrs) from: ุจูุงุณุชูู ุฃุฎุถุฑ 600 ูููู
      โ Reduced to 450 units (3.00 hrs)
   โ Freed 2.00 hrs of 2.00 hrs needed
   โ Merging rollover 300 units โ Total: 300
โ Handover completed successfully (2 operations)
============================================================
Summary:
   โข Task ID: 1
   โข Achievement: 700
   โข Operations: 2
   โข Rollover: YES (Under-achievement)
   โข Next Shift: Third Shift on 2025-01-21
============================================================
```

---

## ๐ฏ ุงูุญุงูุงุช ุงูุฎุงุตุฉ

### โ ููุณ ุงูููุชุฌ ูู ุงูู Shift ุงููุงุฏู
```
ุฅุฐุง ูุงู ุงูููุชุฌ ููุฌูุฏ ุจุงููุนู โ ูุชู ุฏูุฌ ุงููููุงุช
New Total = Original + Rollover
New Hours = Original Hours + Rollover Hours
```

### โ ููุชุฌ ุฌุฏูุฏ ุชูุงูุงู
```
ุฅุฐุง ูู ููู ุงูููุชุฌ ููุฌูุฏ โ ููุดุฃ ุชุงุณู ุฌุฏูุฏ
- Priority: 0 (ุงูุฃุนููุ ูุฃูู rollover)
- is_rollover: true
- Original Task ID: ูุญููุธ ููุชุชุจุน
```

### โ Friday (ููููู ููุท)
```
Friday:
- First Shift: 12 ุณุงุนุฉ
- Second Shift: 12 ุณุงุนุฉ

Days:
- First Shift: 8 ุณุงุนุงุช
- Second Shift: 8 ุณุงุนุงุช
- Third Shift: 8 ุณุงุนุงุช
```

---

## ๐ Production Rate

ูุชู ุญุณุงุจู ุจูุฐุง ุงูุชุฑุชูุจ:
```javascript
1. ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ุงูุฃูุถู)
   production_rate = DB value

2. ุฅุฐุง ูู ููู ููุฌูุฏุ ููุญุณุจ:
   production_rate = target_amount / target_hours

3. ุฅุฐุง ูุดู ุงูุญุณุงุจุ ูููุฉ ุงูุชุฑุงุถูุฉ:
   production_rate = 1
```

---

## โ๏ธ Configuration

```javascript
// ุจุฏุงูุฉ ุงูููู
const NORMAL_SHIFT_ORDER = ['First Shift', 'Second Shift', 'Third Shift'];
const FRIDAY_SHIFT_ORDER = ['First Shift', 'Second Shift'];

// Deduplication timeout
CACHE_TIMEOUT = 60 seconds  // ุชุฌูุจ ุชูููุฐ ููุณ ุงูุนูููุฉ ูุฑุชูู

// Max cascade depth
MAX_CASCADE_DEPTH = 10 shifts  // ุงูุญุฏ ุงูุฃูุตู ููุชุณูุณู
```

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูู Rollover ูุง ูููุฐ
**ุงูุณุจุจ ุงููุญุชูู:**
- โ Production Rate = 0 ุฃู null
- โ Achievement ุจุตูุบุฉ ุฎุงุทุฆุฉ (ูุซูุงู: "700" ุจุฏูู ูุญุฏุฉ)
- โ Task ุบูุฑ ููุฌูุฏ

**ุงูุญู:**
```
ุชุญูู ูู ุงูู logs:
- ุงุจุญุซ ุนู: "Invalid production rate"
- ุชุญูู ูู ุตูุบุฉ Achievement
- ุชุฃูุฏ ูู ูุฌูุฏ Task ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

### ุงููุดููุฉ: Cascade ูุง ููุงุฆู
**ุงูุณุจุจ:**
- ุบุงูุจุงู ุชุตุญูุญ ุชููุงุฆู ุจู MAX_CASCADE_DEPTH

**ุงูุญู:**
```
- ุนุงุฏุฉ ูุง ูุญุฏุซ ูุฃู ุงูุญุฏ ุงูุฃูุตู 10 shifts
- ุฅุฐุง ุงุณุชูุฑุ ุชุญูู ูู ุงูู logs ููู infinite loop
```

---

## ๐ ููุฎุต ุงููููุงุช ุงููุนุฏูุฉ

```
d:\Desktop\Optimize-ops\backend\utils\shiftHandover.js
โโ Line 95-120: ุฅุถุงูุฉ ุฃูุถู Logging
โโ Line 215-290: ุชุญุณูู logic ุชูุฑูุบ ุงูููุงู
โโ Line 1000-1070: ุชุญุณูู Cascade logic
โโ Line 622-640: ุฅุถุงูุฉ ููุฎุต ุงููุชุงุฆุฌ
```

---

**ุขุฎุฑ ุชุญุฏูุซ**: 21 ููุงูุฑ 2026  
**ุงูุฅุตุฏุงุฑ**: 2.0 - Cascade Logic Enhancement
